var guto = 0; //a variável guto serve pra que o evento de click do 'body' seja ativado sem influenciar no click do '.bloco'
arquivoEmEdicao = new edFile("","","","",""); //variavel global que guarda as informações do arquivo que estah sendo editado no momento
var http_file = false;

if(navigator.appName == "Microsoft Internet Explorer") {
	http_file = new ActiveXObject("Microsoft.XMLHTTP");
} else {
	http_file = new XMLHttpRequest();
}

//funcao de teste.
function checkAndSubmit(){
	// alert("UHUUUUUUULL");
	var x;
	x = document.getElementById("texto");
	alert(x.value);
}

//objeto que guarda as informacoes do arquivo que estah sendo editado no momento
function edFile(id, autorNome, tituloNome, nomeFile, tagsNomes){
	this.id = id;
	this.autorNome = autorNome;
	this.tituloNome = tituloNome;
	this.nomeFile = nomeFile;
	this.tagsNomes = tagsNomes;

}

//entra no modo edicao de arquivo
function editarFile(idFile, autorNome , tituloNome, nomeFile, tagsNomes){	
	var autor;
	var titulo;
	var nome;
	var tags;
	var bt_dir;
	var bt_esq;
	
	if (arquivoEmEdicao.id != ""){
		edicaoCancel(autorNome , tituloNome, nomeFile, tagsNomes);	
	}
	else{
		arquivoEmEdicao = new edFile(idFile, autorNome, tituloNome, nomeFile, tagsNomes);
	}
	
	arquivoEmEdicao.id = idFile;
	//alert(idFile);
	
		
	autor=document.getElementById("autor"+idFile);	
	autor.innerHTML = "<input type='text' id='autor_edit"+idFile+"' value='"+autorNome +"' />";
	arquivoEmEdicao.autorNome = autorNome;
	
	titulo = document.getElementById("titulo"+idFile);
	titulo.innerHTML = "<input type='text' id='titulo_edit"+idFile+"' value='"+tituloNome +"' />";
	arquivoEmEdicao.tituloNome = tituloNome;
	
	nome = document.getElementById("nome"+idFile);
	nome.innerHTML = "<input type='text' id='nome_edit"+idFile+"' value='"+nomeFile +"' />";
	arquivoEmEdicao.nomeFile = nomeFile;
	
	tags = document.getElementById("tags"+idFile);
	tags.innerHTML = "<input type='text' id='tags_edit"+idFile+"' value='"+tagsNomes +"' />";
	arquivoEmEdicao.tagsNomes = tagsNomes;
	
	bt_esq = document.getElementById("botao_esquerdo"+idFile);
	bt_esq.src = '../../images/botoes/bt_cancelar_pq.png';
	bt_esq.onclick = function(){edicaoCancel()};
	
	
	bt_dir = document.getElementById("botao_direito"+idFile);
	bt_dir.src = '../../images/botoes/bt_confirm.png';
	//autor.value = "cacilds";
	bt_dir.onclick = function(){edicaoConfirm()};

}

//confirma as mudancas no modo edicao de arquivo, depois sai do modo edicao de arquivos
function edicaoConfirm(){
	
	var autor;
	var titulo;
	var nome;
	var tags;
	autor = document.getElementById("autor_edit"+arquivoEmEdicao.id);
	titulo = document.getElementById("titulo_edit"+arquivoEmEdicao.id);
	nome = document.getElementById("nome_edit"+arquivoEmEdicao.id);
	tags = document.getElementById("tags_edit"+arquivoEmEdicao.id);	
	
	
	http_file.abort();
	var r=confirm("Voce tem certeza que deseja modificar esse arquivo?");
	if (r==true){
		http_file.open("GET", "editarFile.php?idFile=" + arquivoEmEdicao.id+"&titulo="+titulo.value+"&autor="+autor.value+"&nome="+nome.value+"&tags="+tags.value, true);
		http_file.onreadystatechange=function() {
			if ((http_file.readyState == 4) && (http_file.status == 200 )) {
				var retorno = http_file.responseText;
				if (retorno == '1'){
					alert('Arquivo editado com sucesso');
					//deu certo
				}
				else alert(retorno);
				
			}
		}	
		http_file.send(null);	
		
		arquivoEmEdicao.autorNome = autor.value;
		arquivoEmEdicao.tituloNome = titulo.value;
		arquivoEmEdicao.nomeFile = nome.value;
		arquivoEmEdicao.tagsNomes = tags.value;
		edicaoCancel();
		
	}
	
	//alert(autor.innerHTML + " | " + titulo.value + " | " + " | " + nome.innerHTML);

}

//cancela o modo edicao de arquivo.
function edicaoCancel(){
	//alert("grrr");
	autor=document.getElementById("autor"+arquivoEmEdicao.id);	
	autor.innerHTML = arquivoEmEdicao.autorNome;
	
	titulo = document.getElementById("titulo"+arquivoEmEdicao.id);
	titulo.innerHTML = arquivoEmEdicao.tituloNome;
	
	nome = document.getElementById("nome"+arquivoEmEdicao.id);
	nome.innerHTML = arquivoEmEdicao.nomeFile;
	
	tags = document.getElementById("tags"+arquivoEmEdicao.id);
	tags.innerHTML = arquivoEmEdicao.tagsNomes;			
	
	bt_dir = document.getElementById("botao_direito"+arquivoEmEdicao.id);
	bt_dir.src = '../../images/botoes/bt_editar.png';
	bt_dir.onclick = function(){editarFile(arquivoEmEdicao.id,arquivoEmEdicao.autorNome,arquivoEmEdicao.tituloNome, arquivoEmEdicao.nomeFile, arquivoEmEdicao.tagsNomes)};
	
	bt_esq = document.getElementById("botao_esquerdo"+arquivoEmEdicao.id);
	bt_esq.src = '../../images/botoes/bt_excluir.png';
	bt_esq.onclick = function(){excluirFile(arquivoEmEdicao.id)};

}


function excluirFile(idFile){
	http_file.abort();
	var r=confirm("Voce tem certeza que deseja excluir esse arquivo?");
	if (r==true){
		http_file.open("GET", "excluirFile.php?idFile=" + idFile, true);
		http_file.onreadystatechange=function() {
			if ((http_file.readyState == 4) && (http_file.status == 200 )) {
				var retorno = http_file.responseText;
				if (retorno == '1'){
					alert('Arquivo excluido com sucesso');
					//deu certo
				}
				else alert(retorno);
				
			}
		}	
		http_file.send(null);
	}
	
}



//$file = new File(idFile);
//$file->upload();



$(document).ready(function(){
	document.getElementById("arquivos_enviados").style.minHeight = document.getElementById("esq").offsetHeight - 25 + "px";
	var cor_original = $(".bloco").css("border-top-color");
	var fala_original = document.getElementById("balao").innerHTML;
	//funções para trocar as falas do ajudante e pintar o bloco selecionado
	$("body").click(function(){ 
			if (guto != 1){
				$(".bloco").css("border-top-color",cor_original);
				$("#balao").html(fala_original);
			}
			guto = 0;
	});
	$(".bloco").click(function(){
			
			switch (this.id){
				case "procurar_material":
					$("#balao").html("Aqui você busca por materiais já publicados na biblioteca, é só clicar em 